/**
 * Created by lenovo on 2015/10/29.
 */
(function (a) {
    a.fn.citySelect = function (g) {
        if (this.length < 1) {
            return
        }
        var g = a.extend({
            url: {city: "/nnc/citys", dist: "/nnc/countries"},
            prov: ".prov",
            city: ".city",
            dist: ".dist",
            d: false,
            nodata: null,
            required: false
        }, g);
        var d = this, i = a(this);
        var c = i.find(g.prov), f = i.find(g.city), e = i.find(g.dist);
        c.bind("change", function () {
            if (f.length == 0) {
                return false
            }
            var l = a(this).val();
            if (l.length == 0) {
                var k = f.find("option:first"), j = e.find("option:first");
                if (f.length > 0) {
                    f.empty().append(k)
                }
                if (e.length > 0) {
                    e.empty().append(j)
                }
                return false
            }
            a.getJSON(g.url.city, {province_id: l}, function (n) {
                var m = [];
                if (n.status) {
                    m = n.data
                } else {
                    m = n
                }
                b(m)
            });
            if (g.required && g.required.prov) {
                g.required.prov.apply(this, ["prov", l])
            }
        });
        if (!!g.d && !!g.d[0]) {
            c.val(g.d[0])
        } else {
            if (c.find("option").length > 0) {
                c.val(c.find("option:first").attr("value"))
            }
        }
        c.trigger("change");
        f.bind("change", function () {
            if (e.length == 0) {
                return false
            }
            var k = a(this).val();
            if (k.length == 0) {
                var j = e.find("option:first");
                e.empty().append(j);
                return false
            }
            a.getJSON(g.url.dist, {city_id: k}, function (m) {
                var l = [];
                if (m.status) {
                    l = m.data
                } else {
                    l = m
                }
                h(l)
            })
        });
        var b = function (l) {
            var k = f.find("option:first"), j = e.find("option:first");
            f.empty().append(k);
            if (e.length > 0) {
                e.empty().append(j)
            }
            a.each(l, function (m, n) {
                f.append('<option value="' + n.id + '">' + n.name + "</option>")
            });
            if (g.d[1]) {
                f.find("option[value='" + g.d[1] + "']").attr("selected", true).end().trigger("change");
                g.d[1] = false
            }
        };
        var h = function (k) {
            var j = e.find("option:first");
            e.empty().append(j);
            a.each(k, function (l, m) {
                e.append('<option value="' + m.id + '">' + m.name + "</option>")
            });
            if (g.d[2]) {
                e.find("option[value='" + g.d[2] + "']").attr("selected", true);
                g.d[2] = false
            }
        }
    }
})(jQuery);